from web3 import Web3
from dotenv import load_dotenv
import os

load_dotenv()

rpc_url = os.getenv("RPC_URL")

# Connect to an Ethereum node
w3 = Web3(Web3.HTTPProvider(rpc_url))

# Get the pending block
pending_block = w3.eth.get_block("pending", full_transactions=True)

# Process each pending transaction
for tx in pending_block.transactions:
    # Extract the fields you're interested in
    chain_id = w3.eth.chain_id  # Get chain ID from the network
    from_address = tx["from"]
    to_address = tx.get(
        "to", "Contract Creation"
    )  # 'to' might be None for contract creation
    data = tx["input"]
    gas_limit = tx["gas"]
    value = tx["value"]
    hash = tx["hash"]

    print(f"Chain ID: {chain_id}")
    print(f"From: {from_address}")
    print(f"To: {to_address}")
    print(f"Tx Hash: {hash.hex()}")
    print(f"Data: {data.hex()}")
    print(f"Gas Limit: {gas_limit}")
    print(f"Value: {value}")
    print("---")
