package main

import (
	"log"
	"os"

	"github.com/rahul7668gupta/sc-exploit/pkg/service"
	"github.com/rahul7668gupta/sc-exploit/pkg/utils/email"
)

func main() {

	clientURL := os.Getenv("ETHEREUM_CLIENT_URL")
	contractAddrAttack := os.Getenv("CONTRACT_ADDRESS_ATTACK")
	contractAddrVulnerableProxy := os.Getenv("CONTRACT_ADDRESS_VULNERABLE_PROXY")
	privateKey := os.Getenv("OWNER_PRIVATE_KEY")
	dbConnString := os.Getenv("DB_CONN_STRING")

	if clientURL == "" || contractAddrAttack == "" || contractAddrVulnerableProxy == ""  || privateKey == "" || dbConnString == "" {
		log.Fatalf("Please provide values for ETHEREUM_CLIENT_URL, CONTRACT_ADDRESS, OWNER_PRIVATE_KEY, and DB_CONN_STRING")
	}

	emailService, err := email.NewEmailService()
	if err != nil {
		log.Fatalf("Failed to create EmailService: %v", err)
	}

	pauser, err := service.NewContractPauser(clientURL, contractAddrAttack, contractAddrVulnerableProxy, privateKey, dbConnString, emailService)
	if err != nil {
		log.Fatalf("Failed to create ContractPauser: %v", err)
	}

	pauser.MonitorPendingTransactions()
}
